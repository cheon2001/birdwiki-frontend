<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Birdwiki 문서</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .section-ref {
      margin-top: 0.5rem;
      padding: 0.6rem;
      background-color: #f5f5f5;
      border-left: 4px solid #888;
      font-size: 0.9rem;
      color: #333;
    }
    .image-caption {
      font-size: 0.85rem;
      color: #666;
      text-align: center;
      margin-bottom: 1rem;
    }
    .section-inline-images {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: flex-start;
      margin: 1rem 0;
    }
    
    .section-image {
      width: 100%;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: block;
    }
  </style>
</head>
<body>
  <header class="top-bar">
    <a href="index.html" class="logo-group">
      <img src="assets/icons/Birdwiki_icon.png" alt="Birdwiki Logo" class="logo-icon" />
      <div class="logo">
        <strong>Birdwiki</strong> : Birds of South Korea
      </div>
    </a>
    <nav class="nav-menu">
      <a href="index.html" class="nav-link">Birdwiki</a>
      <a href="#" class="nav-link">토론장</a>
      <a href="#" class="nav-link">게시판</a>
      <a href="write.html" class="nav-link important">문서 만들기</a>
      <img src="assets/icons/User_icon.png" alt="User" class="user-icon" />
    </nav>
  </header>

  <div class="hero-section flush-to-header">
    <img id="cover-image" class="hero-background" />
    <button id="edit-button" class="hero-edit-button">✏️ 문서 수정</button>
    <div class="hero-overlay">
      <h1 id="korean-name">국명</h1>
      <em id="scientific-name" class="sci-name"></em>
      <p id="english-name" class="eng-name"></p>
      <p id="classification">
        <span id="order"></span> &gt;
        <span id="family"></span> &gt;
        <span id="genus"></span>
      </p>
    </div>
  </div>

  <main class="article-page">
    <article class="article-content">
      <div id="doc-content">로딩 중...</div>
    </article>
  </main>

  <div id="lightbox" class="image-lightbox-overlay">
    <img src="" alt="확대 이미지" />
  </div>
  

  <script>
    const params = new URLSearchParams(window.location.search);
    const title = params.get('title');

    function renderContent(text) {
      const lines = text.split('\n');
      const container = document.getElementById('doc-content');
      container.innerHTML = '';

      let currentSection = null;
      let imageContainer = null;

      lines.forEach(line => {
        if (line.startsWith('## ')) {
          const h2 = document.createElement('h2');
          h2.textContent = line.replace('## ', '');
          container.appendChild(h2);
          currentSection = container;
          imageContainer = null;
        } else if (line.startsWith('### ')) {
          const h3 = document.createElement('h3');
          h3.textContent = line.replace('### ', '');
          h3.className = 'subheading-title';
          container.appendChild(h3);
          currentSection = container;
          imageContainer = null;
        } else if (line.startsWith('![')) {
          const altMatch = line.match(/!\[(.*?)\]\((.*?)\)/);
          if (altMatch) {
            const [_, alt, src] = altMatch;

            if (!imageContainer) {
              imageContainer = document.createElement('div');
              imageContainer.className = 'section-inline-images';
              currentSection.appendChild(imageContainer);
            }

            const block = document.createElement('div');
            block.className = 'image-block';

            const img = document.createElement('img');
            img.src = src;
            img.alt = alt;
            img.className = 'section-image';



            const caption = document.createElement('p');
            caption.textContent = alt;
            caption.className = 'image-caption';

            block.appendChild(img);
            block.appendChild(caption);
            imageContainer.appendChild(block);
          }
        } else if (line.startsWith('\ud83d\udcda \ucc38고문헌:')) {
          const refText = line.replace('\ud83d\udcda \ucc38고문헌:', '').trim();
          const ref = document.createElement('div');
          ref.className = 'section-ref';
          ref.innerHTML = `<strong>참고문헌:</strong> ${refText}`;
          currentSection.appendChild(ref);
        } else if (line.trim() !== '') {
          const p = document.createElement('p');
          p.textContent = line;
          currentSection.appendChild(p);
        }
      });
    }

    if (!title) {
      document.getElementById('doc-title').textContent = '❌ 제목이 제공되지 않았습니다.';
    } else {
         fetch(`https://birdwiki.onrender.com/api/wiki/${title}`)
        .then(res => res.ok ? res.json() : Promise.reject('문서를 찾을 수 없습니다'))
        .then(data => {
          document.getElementById('korean-name').textContent = data.koreanName || data.title;
          document.getElementById('scientific-name').textContent = data.scientificName || '';
          document.getElementById('english-name').textContent = data.englishName || '';
          document.getElementById('order').textContent = data.order || '';
          document.getElementById('family').textContent = data.family || '';
          document.getElementById('genus').textContent = data.genus || '';
          if (data.coverImage) {
            document.getElementById('cover-image').src = data.coverImage;
          }
          renderContent(data.content);
        })
        .catch(err => {
          document.getElementById('doc-title').textContent = '❌ 문서를 찾을 수 없음';
          document.getElementById('doc-content').textContent = err;
        });
    }

    document.getElementById("edit-button").addEventListener("click", () => {
      window.location.href = `write.html?title=${encodeURIComponent(title)}&edit=true`;
    });

    

document.getElementById("lightbox").addEventListener("click", () => {
  document.getElementById("lightbox").style.display = "none";
});

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    document.getElementById("lightbox").style.display = "none";
  }
});


document.addEventListener("DOMContentLoaded", () => {
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = lightbox.querySelector("img");

  document.body.addEventListener("click", (e) => {
    if (e.target.classList.contains("section-image")) {
      lightboxImg.src = e.target.src;
      lightbox.style.display = "flex";
    }
  });

  lightbox.addEventListener("click", () => {
    lightbox.style.display = "none";
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      lightbox.style.display = "none";
    }
  });
});
  </script>
</body>
</html>